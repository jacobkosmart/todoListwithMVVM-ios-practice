### ğŸ”· Add a ViewModel with Environment Object

#### ğŸ”¶ 1.StateObject ìƒì„±

- MVVM struct ì—ì„œ ViewModel ì„ ìƒì„±í•©ë‹ˆë‹¤. ë¨¼ì € TodoListApp ê°€ì„œ StateObject ìƒì„± ë° environmentObject ë¥¼ ì—°ê²° ì‹œí‚µë‹ˆë‹¤ (app ê¸€ë¡œë²Œë¡œ listViewModel ì˜ data ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆê²Œ í•´ì¤Œ)

```swift
// TodoListApp.swift
import SwiftUI

/*

 MVVM Architecture

 Model - Data point
 View - UI
 ViewModel - manages Models for View

 */

@main
struct TodoListApp: App {

// StateObject
@StateObject var listViewModel: ListViewModel = ListViewModel()

var body: some Scene {
  WindowGroup {
    NavigationView {
      ListView()
    } //: NAVIGATION
    .environmentObject(listViewModel)
  }
}
}

```

#### ğŸ”¶ 2.ListViewModel ì‘ì„±

- ListView ì—ì„œ logic ë“¤ì„ ë”°ë¡œ ë¹¼ì„œ ListViewModel ì„ ë§Œë“­ë‹ˆë‹¤

```swift
//  ListViewModel.swift
import Foundation

class ListViewModel: ObservableObject {
	// MARK: -  PROPERTY
	@Published var items: [ItemModel] = []

	// MARK: -  INIT
	init() {
		getItems()
	}

	// MARK: -  FUNCTION

	// getItems
func getItems() {
  let newItems = [
    ItemModel(title: "This is the first tile!", isCompleted: false),
    ItemModel(title: "This is the second", isCompleted: true),
    ItemModel(title: "This is the Third", isCompleted: false)
  ]
  items.append(contentsOf: newItems)
}

// deleteItems
func deleteItem(indexSet: IndexSet) {
    items.remove(atOffsets: indexSet)
}

// moveItems
func moveItem(from: IndexSet, to: Int) {
  items.move(fromOffsets: from, toOffset: to)
}

// addItems
func addItem(title: String) {
  let newItem = ItemModel(title: title, isCompleted: false)
  items.append(newItem)
}

// update isCompleted
func updateItem(item: ItemModel) {
  if let index = items.firstIndex(where: { $0.id == item.id}) {
    items[index] = item.updateCompletion()
  }
}
}

```

#### ğŸ”¶ 3. ListView ì— ViewModel ì ìš©

- @EnvironmentObject ë¥¼ í†µí•´ì„œ published ëœ ListViewModel ì„ ì°¸ì¡°í•´ì„œ ë³€ìˆ˜ method ì„ ì…ë ¥í•©ë‹ˆë‹¤

```swift
//  ListView.swift

import SwiftUI

struct ListView: View {

// MARK: -  PROPERTY

// Environment Object
@EnvironmentObject var listViewModel: ListViewModel

// MARK: -  BODY
var body: some View {
// list loop
List {
ForEach(listViewModel.items) { item in
  ListRowView(item: item)
  // toggle ì‹œ !isCompleted ê°€ ë˜ê²Œ í•˜ëŠ” logic
    .onTapGesture {
      withAnimation(.linear) {
        listViewModel.updateItem(item: item)
      }
    }
}
// delete list
.onDelete(perform:listViewModel.deleteItem)
// move list
.onMove(perform: listViewModel.moveItem)
}
.listStyle(PlainListStyle())
.navigationTitle("Todo List ğŸ“")
// trailing ì— ADD ë²„íŠ¼ ì„ í´ë¦­í•˜ë©´ AddView() ë¡œ ì´ë™
.navigationBarItems(
leading: EditButton(),
trailing: NavigationLink("ADD", destination: AddView())
)
}
}

// MARK: -  PREVIEW
struct ListView_Previews: PreviewProvider {
static var previews: some View {
  NavigationView {
    ListView()
      .preferredColorScheme(.dark)
  } //: NAVIGATION
  .environmentObject(ListViewModel())
}
}

```

#### ğŸ”¶ 4.Model ë³€ê²½

- Immutable struct ë¡œ ìƒì„±ëœ model ì— method ë¥¼ ì¶”ê°€í•´ì„œ toggle ì‹œ isCompleted ê°€ ë³€ê²½ ë  ìˆ˜ ìˆê²Œ ë³€ê²½í•¨

```swift
//  ItemModel.swift

import Foundation
// Immutable Struct
struct ItemModel: Identifiable {
	let id: String
	let title: String
	let isCompleted: Bool

	init(id: String = UUID().uuidString, title: String, isCompleted: Bool) {
		self.id = id
		self.title = title
		self.isCompleted = isCompleted
	}

	// model ì´ immutable struct ì´ê¸° ë•Œë¬¸ì— isCompleted ì„ ë°”ê¾¸ê¸° ìœ„í•´ì„œ func ë¥¼
	func updateCompletion() -> ItemModel {
		return ItemModel(id: id, title: title, isCompleted: !isCompleted)
	}
}

// ItemModel ì— ìë™ì™„ì„±ìœ¼ë¡œ 2ê°œê°€ ìƒì„± id ê°€ ìë™ ìƒì„±í•˜ëŠ”ê±° 1ê°œ, UUID() ë¡œ ìë™ ì™„ì„±ë˜ëŠ”ê±° 1ê°œ
// ItemModel(id: <#T##String#>, title: <#T##String#>, isCompleted: <#T##Bool#>)
// ItemModel(title: <#T##String#>, isCompleted: <#T##Bool#>)

```

#### ğŸ”¶ 5.AddView ë³€ê²½

- textFieldText ì— ì…ë ¥ëœ ê°’ì„ save button ì„ ëˆ„ë¥´ë©´, ListViewModel ë¡œ ë„˜ê¸°ê³ , presentationMode ì„ dismiss() í•´ì„œ ì°½ì„ ë‹«ê²Œ í•¨

- ì…ë ¥ëœ ê°’ì´ 2ê¸€ì ì´í•˜ ì¼ ê²½ìš°, alert ì°½ì´ ìƒì„±ë˜ê²Œ í•¨

```swift
//  AddView.swift

import SwiftUI
struct AddView: View {
	// MARK: -  PROPERTY
	@Environment(\.presentationMode) var presentationMode
	@EnvironmentObject var listViewModel: ListViewModel
	@State var textFieldText: String = ""

	@State var alertTitle: String = ""
	@State var showAlert: Bool = false


	// MARK: -  BODY
var body: some View {
ScrollView {
VStack {
  // TextField
  TextField("Type something here...", text: $textFieldText)
    .padding(.horizontal)
    .frame(height: 55)
    .background(.ultraThinMaterial)
  .cornerRadius(10)

  // Button
  Button(action: saveButtonPressed) {
    Text("Save".uppercased())
      .frame(height: 55)
      .frame(maxWidth: .infinity)
      .font(.headline)
      .foregroundColor(.white)
      .background(Color.accentColor)
      .cornerRadius(10)
  }
} //: VSTACK
.padding(14)
}
.navigationTitle("Add and Item ğŸ–Š")
.alert(isPresented: $showAlert, content: getAlert)
	}

	// MARK: -  FUNCTION

	// saveButton Action: listViewmodel ì— add í•˜ê³  presentaionMode dismiss()
	func saveButtonPressed() {
		if textIsAppropriate() {
			listViewModel.addItem(title: textFieldText)
			presentationMode.wrappedValue.dismiss()
		}
	}

	// textField ê°€ 2ê¸€ì ì´í•˜ë©´ false return
	func textIsAppropriate() -> Bool {
		if textFieldText.count < 3 {
			alertTitle = "Your new todo item must be at least 3 characters long!! ğŸ˜°"
			showAlert.toggle()
			return false
		}
		return true
	}

	// getAlert
	func getAlert() -> Alert {
		return Alert(title: Text(alertTitle))
	}
}

// MARK: -  PREVIEW
struct AddView_Previews: PreviewProvider {
	static var previews: some View {
		NavigationView {
			AddView()
		}
		.environmentObject(ListViewModel())
	}
}

```
